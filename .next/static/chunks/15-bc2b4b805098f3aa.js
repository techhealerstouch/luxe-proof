"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{72:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(5155),o=r(6766);let n={src:"/_next/static/media/logo.280af7fc.svg",height:219,width:1070,blurWidth:0,blurHeight:0};function s(e){let{width:t=120,height:r=60,className:s}=e;return(0,a.jsx)(o.default,{src:n,alt:"Company Logo",width:t,height:r,className:s,priority:!0})}},3999:(e,t,r)=>{r.d(t,{cn:()=>n});var a=r(2596),o=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}},4861:(e,t,r)=>{r.d(t,{A:()=>f,AuthProvider:()=>u});var a=r(5155),o=r(2115),n=r(5695),s=r(3464),i=r(6671);let l={ACCESS_TOKEN:"accessToken",REFRESH_TOKEN:"refreshToken",USER:"user",LOGGED_IN:"loggedIn",JUST_LOGGED_IN:"justLoggedIn",AUTH_TOKEN:"auth_token",PKCE_VERIFIER:"pkce_code_verifier"},c={LOGIN:"/login",DASHBOARD:"/dashboard"},d=(0,o.createContext)(null);function u(e){let{children:t}=e,[r,u]=(0,o.useState)(null),[f,h]=(0,o.useState)(!0),g=(0,n.useRouter)(),p="http://localhost:8000",m=(0,o.useCallback)(()=>{Object.values(l).forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)})},[]),v=(0,o.useCallback)(e=>{sessionStorage.setItem(l.USER,JSON.stringify(e)),sessionStorage.setItem(l.LOGGED_IN,"true"),u(e)},[]),w=(0,o.useCallback)(()=>{try{let e=sessionStorage.getItem(l.USER);if(!e)return null;let t=JSON.parse(e);return t.data||t}catch(e){return console.error("Failed to parse stored user:",e),sessionStorage.removeItem(l.USER),null}},[]),S=(0,o.useCallback)(async e=>{let t=localStorage.getItem(l.PKCE_VERIFIER);if(!t)throw Error("PKCE code verifier missing. Please start the login process again.");let r=new URLSearchParams({grant_type:"authorization_code",client_id:"0198ac9b-cb66-7261-b733-6cb6432c26c7",redirect_uri:"".concat("http://localhost:3001","/auth/callback"),code:e,code_verifier:t});try{let e=await fetch("".concat(p,"/oauth/token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:r.toString()}),t=await e.json();if(!e.ok)throw console.error("OAuth token error response:",t),Error(t.error_description||"Failed to exchange authorization code");return localStorage.removeItem(l.PKCE_VERIFIER),t}catch(e){throw console.error("Token exchange failed:",e),e}},[p]),b=(0,o.useCallback)(async()=>{try{let e=await fetch("".concat(p,"/api/refresh-token"),{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to refresh token");return(await e.json()).access_token}catch(e){throw console.error("Token refresh failed:",e),window.location.href=c.LOGIN,e}},[p]),y=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=localStorage.getItem(l.ACCESS_TOKEN);if(!t)throw Error("No access token available");try{let r=await fetch("".concat(p,"/api/user"),{method:"GET",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"}});if(!r.ok){if(401===r.status){let t=await b();return localStorage.setItem(l.ACCESS_TOKEN,t),y(e)}throw Error("Failed to fetch user data")}let a=await r.json(),o=a.data||a;return v(o),sessionStorage.getItem(l.JUST_LOGGED_IN)&&(i.o.success("Logged in successfully!"),sessionStorage.removeItem(l.JUST_LOGGED_IN)),e&&g.push(c.DASHBOARD),o}catch(e){throw console.error("Error fetching user data:",e),e}},[p,b,g,v]),E=(0,o.useCallback)(async e=>{let t=localStorage.getItem(l.ACCESS_TOKEN);if(!t)throw Error("No auth token found");console.log(e);let r={name:e.name,email:e.email,phone_number:e.phone_number,timezone:e.timezone,account:{name:e.businessName,slug:e.businessSlug}};try{let e=await s.A.put("".concat(p,"/api/user"),r,{headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"}}),a=e.data.data||e.data;return v(a),i.o.success("Watch data submitted successfully"),a}catch(e){throw i.o.error("Profile Update Failed!"),e}},[p,v]),C=(0,o.useCallback)(()=>{let e=localStorage.getItem(l.ACCESS_TOKEN),t=sessionStorage.getItem(l.USER);return!!(e&&t)},[]),N=(0,o.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=localStorage.getItem(l.ACCESS_TOKEN);if(!r)throw Error("No access token available");let a=async r=>fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(r),Accept:"application/json","Content-Type":"application/json"}}),o=await a(r);if(401===o.status)try{let e=await b();return localStorage.setItem(l.ACCESS_TOKEN,e),a(e)}catch(e){throw await x(),e}return o},[b]),_=(0,o.useCallback)(async(e,t,r)=>{console.log(e);let a=localStorage.getItem(l.ACCESS_TOKEN);try{let o=await N("".concat(p,"/api/user/change-password"),{headers:{Authorization:"Bearer ".concat(a),Accept:"application/json","Content-Type":"application/json"},method:"PUT",credentials:"include",body:JSON.stringify({currentPassword:e,newPassword:t,newPassword_confirmation:r})});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to change password")}i.o.success("Password changed successfully!")}catch(e){throw i.o.error(e.message||"Password change failed"),e}},[N,p]),x=(0,o.useCallback)(async()=>{try{let e=localStorage.getItem(l.ACCESS_TOKEN);e&&await fetch("".concat(p,"/api/logout"),{method:"POST",credentials:"include",headers:{Accept:"application/json",Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout API call failed:",e)}finally{m(),u(null),window.location.href=c.LOGIN}},[p,m]);return((0,o.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem(l.ACCESS_TOKEN);if(sessionStorage.getItem(l.JUST_LOGGED_IN)&&e){await y(!0);return}let t=w();if(t){u(t),window.location.pathname===c.LOGIN&&g.push(c.DASHBOARD);return}if(e)try{await y(!0)}catch(e){console.error("Failed to restore session:",e),localStorage.removeItem(l.ACCESS_TOKEN)}}catch(e){console.error("Auth initialization error:",e)}finally{h(!1)}})()},[]),f)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):(0,a.jsx)(d.Provider,{value:{user:r,isLoading:f,logout:x,updateUser:E,changePassword:_,exchangeAuthorizationCode:S,refreshAccessToken:b,fetchUserData:y,isAuthenticated:C,authenticatedRequest:N},children:t})}let f=()=>{let e=(0,o.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7168:(e,t,r)=>{r.d(t,{$:()=>c,r:()=>l});var a=r(5155),o=r(2115),n=r(9708),s=r(2085),i=r(3999);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:o,size:s,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(l({variant:o,size:s,className:r})),ref:t,...d})});c.displayName="Button"},8482:(e,t,r)=>{r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>s,aR:()=>i,wL:()=>u});var a=r(5155),o=r(2115),n=r(3999);let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})});s.displayName="Card";let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...o})});i.displayName="CardHeader";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});l.displayName="CardTitle";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...o})});c.displayName="CardDescription";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...o})});d.displayName="CardContent";let u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...o})});u.displayName="CardFooter"},9026:(e,t,r)=>{r.d(t,{Fc:()=>l,TN:()=>d,XL:()=>c});var a=r(5155),o=r(2115),n=r(2085),s=r(3999);let i=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=o.forwardRef((e,t)=>{let{className:r,variant:o,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,s.cn)(i({variant:o}),r),...n})});l.displayName="Alert";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("h5",{ref:t,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",r),...o})});c.displayName="AlertTitle";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",r),...o})});d.displayName="AlertDescription"}}]);