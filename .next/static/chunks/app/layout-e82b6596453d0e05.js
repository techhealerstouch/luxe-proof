(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(9946).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1805:(e,t,a)=>{Promise.resolve().then(a.bind(a,7365)),Promise.resolve().then(a.bind(a,4861)),Promise.resolve().then(a.t.bind(a,7459,23)),Promise.resolve().then(a.t.bind(a,9324,23)),Promise.resolve().then(a.bind(a,6671))},4861:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,AuthProvider:()=>h});var r=a(5155),o=a(2115),n=a(5695),s=a(3464),c=a(6671);let l={ACCESS_TOKEN:"accessToken",REFRESH_TOKEN:"refreshToken",USER:"user",LOGGED_IN:"loggedIn",JUST_LOGGED_IN:"justLoggedIn",AUTH_TOKEN:"auth_token",PKCE_VERIFIER:"pkce_code_verifier"},i={LOGIN:"/login",DASHBOARD:"/dashboard"},u=(0,o.createContext)(null);function h(e){let{children:t}=e,[a,h]=(0,o.useState)(null),[d,m]=(0,o.useState)(!0),g=(0,n.useRouter)(),p="http://localhost:8000",f=(0,o.useCallback)(()=>{Object.values(l).forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)})},[]),S=(0,o.useCallback)(e=>{sessionStorage.setItem(l.USER,JSON.stringify(e)),sessionStorage.setItem(l.LOGGED_IN,"true"),h(e)},[]),E=(0,o.useCallback)(()=>{try{let e=sessionStorage.getItem(l.USER);if(!e)return null;let t=JSON.parse(e);return t.data||t}catch(e){return console.error("Failed to parse stored user:",e),sessionStorage.removeItem(l.USER),null}},[]),w=(0,o.useCallback)(async e=>{let t=localStorage.getItem(l.PKCE_VERIFIER);if(!t)throw Error("PKCE code verifier missing. Please start the login process again.");let a=new URLSearchParams({grant_type:"authorization_code",client_id:"0198ac9b-cb66-7261-b733-6cb6432c26c7",redirect_uri:"".concat("http://localhost:3001","/auth/callback"),code:e,code_verifier:t});try{let e=await fetch("".concat(p,"/oauth/token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:a.toString()}),t=await e.json();if(!e.ok)throw console.error("OAuth token error response:",t),Error(t.error_description||"Failed to exchange authorization code");return localStorage.removeItem(l.PKCE_VERIFIER),t}catch(e){throw console.error("Token exchange failed:",e),e}},[p]),C=(0,o.useCallback)(async()=>{try{let e=await fetch("".concat(p,"/api/refresh-token"),{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to refresh token");return(await e.json()).access_token}catch(e){throw console.error("Token refresh failed:",e),window.location.href=i.LOGIN,e}},[p]),A=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=localStorage.getItem(l.ACCESS_TOKEN);if(!t)throw Error("No access token available");try{let a=await fetch("".concat(p,"/api/user"),{method:"GET",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"}});if(!a.ok){if(401===a.status){let t=await C();return localStorage.setItem(l.ACCESS_TOKEN,t),A(e)}throw Error("Failed to fetch user data")}let r=await a.json(),o=r.data||r;return S(o),sessionStorage.getItem(l.JUST_LOGGED_IN)&&(c.o.success("Logged in successfully!"),sessionStorage.removeItem(l.JUST_LOGGED_IN)),e&&g.push(i.DASHBOARD),o}catch(e){throw console.error("Error fetching user data:",e),e}},[p,C,g,S]),_=(0,o.useCallback)(async e=>{let t=localStorage.getItem(l.ACCESS_TOKEN);if(!t)throw Error("No auth token found");console.log(e);let a={name:e.name,email:e.email,phone_number:e.phone_number,timezone:e.timezone,account:{name:e.businessName,slug:e.businessSlug}};try{let e=await s.A.put("".concat(p,"/api/user"),a,{headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"}}),r=e.data.data||e.data;return S(r),c.o.success("Watch data submitted successfully"),r}catch(e){throw c.o.error("Profile Update Failed!"),e}},[p,S]),y=(0,o.useCallback)(()=>{let e=localStorage.getItem(l.ACCESS_TOKEN),t=sessionStorage.getItem(l.USER);return!!(e&&t)},[]),k=(0,o.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=localStorage.getItem(l.ACCESS_TOKEN);if(!a)throw Error("No access token available");let r=async a=>fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(a),Accept:"application/json","Content-Type":"application/json"}}),o=await r(a);if(401===o.status)try{let e=await C();return localStorage.setItem(l.ACCESS_TOKEN,e),r(e)}catch(e){throw await N(),e}return o},[C]),I=(0,o.useCallback)(async(e,t,a)=>{console.log(e);let r=localStorage.getItem(l.ACCESS_TOKEN);try{let o=await k("".concat(p,"/api/user/change-password"),{headers:{Authorization:"Bearer ".concat(r),Accept:"application/json","Content-Type":"application/json"},method:"PUT",credentials:"include",body:JSON.stringify({currentPassword:e,newPassword:t,newPassword_confirmation:a})});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to change password")}c.o.success("Password changed successfully!")}catch(e){throw c.o.error(e.message||"Password change failed"),e}},[k,p]),N=(0,o.useCallback)(async()=>{try{let e=localStorage.getItem(l.ACCESS_TOKEN);e&&await fetch("".concat(p,"/api/logout"),{method:"POST",credentials:"include",headers:{Accept:"application/json",Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout API call failed:",e)}finally{f(),h(null),window.location.href=i.LOGIN}},[p,f]);return((0,o.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem(l.ACCESS_TOKEN);if(sessionStorage.getItem(l.JUST_LOGGED_IN)&&e){await A(!0);return}let t=E();if(t){h(t),window.location.pathname===i.LOGIN&&g.push(i.DASHBOARD);return}if(e)try{await A(!0)}catch(e){console.error("Failed to restore session:",e),localStorage.removeItem(l.ACCESS_TOKEN)}}catch(e){console.error("Auth initialization error:",e)}finally{m(!1)}})()},[]),d)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):(0,r.jsx)(u.Provider,{value:{user:a,isLoading:d,logout:N,updateUser:_,changePassword:I,exchangeAuthorizationCode:w,refreshAccessToken:C,fetchUserData:A,isAuthenticated:y,authenticatedRequest:k},children:t})}let d=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7365:(e,t,a)=>{"use strict";a.d(t,{AuthGuard:()=>i});var r=a(5155),o=a(4861),n=a(5695),s=a(2115),c=a(8006);let l=["/login","/register","/forgot-password","/auth/callback"];function i(e){let{children:t}=e,{user:a,isLoading:i,isAuthenticated:u}=(0,o.A)(),h=(0,n.useRouter)(),d=(0,n.usePathname)(),m=l.some(e=>d.startsWith(e));return((0,s.useEffect)(()=>{!i&&(m||u()||h.push("/login?from=".concat(encodeURIComponent(d))),m&&u()&&"/login"===d&&h.push("/dashboard"))},[i,u,m,d,h]),!i&&(m||a))?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(c.n,{})}},7459:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_f367f3"}},8006:(e,t,a)=>{"use strict";a.d(t,{n:()=>n});var r=a(5155),o=a(1154);function n(){return(0,r.jsxs)("div",{className:"flex h-screen items-center justify-center flex-col gap-4 bg-background",children:[(0,r.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading..."})]})}},9324:()=>{},9946:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(2115);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:o=24,strokeWidth:c=2,absoluteStrokeWidth:l,className:i="",children:u,iconNode:h,...d}=e;return(0,r.createElement)("svg",{ref:t,...s,width:o,height:o,stroke:a,strokeWidth:l?24*Number(c)/Number(o):c,className:n("lucide",i),...d},[...h.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(u)?u:[u]])}),l=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:l,...i}=a;return(0,r.createElement)(c,{ref:s,iconNode:t,className:n("lucide-".concat(o(e)),l),...i})});return a.displayName="".concat(e),a}}},e=>{var t=t=>e(e.s=t);e.O(0,[385,374,441,684,358],()=>t(1805)),_N_E=e.O()}]);